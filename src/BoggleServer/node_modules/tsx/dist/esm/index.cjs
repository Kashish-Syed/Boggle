"use strict";var j=require("node:worker_threads"),m=require("../node-features-CKvB621_.cjs"),J=require("../register-SR2QYUsS.cjs"),P=require("node:url"),k=require("../index-BIzNEUOn.cjs"),f=require("../is-relative-path-pattern-Cr3_Gkbv.cjs"),R=require("../client-DjommMgI.cjs"),l=require("node:path"),h=require("get-tsconfig"),q=require("node:fs");require("node:module"),require("esbuild"),require("node:crypto"),require("node:os"),require("../temporary-directory-B83uKxJF.cjs"),require("node:net"),require("../get-pipe-path-b8D5AZgV.cjs");const u={active:!0},M=async e=>{if(!e)throw new Error(`tsx must be loaded with --import instead of --loader
The --loader flag was deprecated in Node v20.6.0 and v18.19.0`);u.namespace=e.namespace,e.port&&(u.port=e.port,e.port.on("message",t=>{t==="deactivate"&&(u.active=!1,e.port.postMessage({type:"deactivated"}))}))},$=()=>"process.setSourceMapsEnabled(true);",g=new Map,A=async e=>{if(g.has(e))return g.get(e);if(!await q.promises.access(e).then(()=>!0,()=>!1)){g.set(e,void 0);return}const a=await q.promises.readFile(e,"utf8");try{const s=JSON.parse(a);return g.set(e,s),s}catch{throw new Error(`Error parsing: ${e}`)}},D=async e=>{let t=new URL("package.json",e);for(;!t.pathname.endsWith("/node_modules/package.json");){const a=P.fileURLToPath(t),s=await A(a);if(s)return s;const o=t;if(t=new URL("../package.json",t),t.pathname===o.pathname)break}},b=async e=>(await D(e))?.type??"commonjs",p=process.env.TSX_TSCONFIG_PATH?{path:l.resolve(process.env.TSX_TSCONFIG_PATH),config:h.parseTsconfig(process.env.TSX_TSCONFIG_PATH)}:h.getTsconfig(),I=p&&h.createFilesMatcher(p),O=p&&h.createPathsMatcher(p),L=p?.config.compilerOptions?.allowJs??!1,N="file://",_=/\.([cm]?ts|[tj]sx)($|\?)/,C=/\.json(?:$|\?)/,W=e=>{const t=l.extname(e.split("?")[0]);if(t===".json")return"json";if(t===".mjs"||t===".mts")return"module";if(t===".cjs"||t===".cts")return"commonjs"},G=e=>{const t=W(e);if(t)return t;if(_.test(e))return b(e)},w="tsx-namespace=",y=e=>{const t=e.indexOf(w);if(t===-1)return;const a=e[t-1];if(a!=="?"&&a!=="&")return;const s=t+w.length,o=e.indexOf("&",s);return o===-1?e.slice(s):e.slice(s,o)},T=m.isFeatureSupported(m.importAttributes)?"importAttributes":"importAssertions",H=async(e,t,a)=>{if(!u.active||u.namespace&&u.namespace!==y(e))return a(e,t);if(u.port){const r=new URL(e);r.searchParams.delete("tsx-namespace"),u.port.postMessage({type:"load",url:r.toString()})}R.parent.send&&R.parent.send({type:"dependency",path:e}),C.test(e)&&(t[T]||(t[T]={}),t[T].type="json");const s=await a(e,t);if(!s.source)return s;const o=e.startsWith("file://")?P.fileURLToPath(e):e,i=s.source.toString();if(s.format==="json"||_.test(e)){const r=await k.transform(i,o,{tsconfigRaw:I?.(o)});return{format:"module",source:f.inlineSourceMap(r)}}if(s.format==="module"){const r=k.transformDynamicImport(o,i);r&&(s.source=f.inlineSourceMap(r))}return s},S=/\/(?:$|\?)/,E=async(e,t,a)=>{const s=await e(t,a);return!s.format&&s.url.startsWith(N)&&(s.format=await G(s.url)),s},X=[".js",".json",".ts",".tsx",".jsx"],v=async(e,t,a)=>{const[s,o]=e.split("?");let i;for(const r of X)try{return await E(a,s+r+(o?`?${o}`:""),t)}catch(n){if(i===void 0&&n instanceof Error){const{message:c}=n;n.message=n.message.replace(`${r}'`,"'"),n.stack=n.stack.replace(c,n.message),i=n}}throw i},U=async(e,t,a)=>{const s=S.test(e),o=s?"index":"/index",[i,r]=e.split("?");try{return await v(i+o+(r?`?${r}`:""),t,a)}catch(n){if(!s)try{return await v(e,t,a)}catch{}const c=n,{message:d}=c;throw c.message=c.message.replace(`${o.replace("/",l.sep)}'`,"'"),c.stack=c.stack.replace(d,c.message),c}},F=async(e,t,a,s)=>{if(!u.active)return a(e,t);const o=e.startsWith(N)||l.isAbsolute(e)||f.isRelativePathPattern.test(e),i=t.parentURL&&y(t.parentURL);if(o){let r=y(e);if(i&&!r&&(r=i,e+=`${e.includes("?")?"&":"?"}${w}${i}`),u.namespace&&u.namespace!==r)return a(e,t);if(S.test(e))return await U(e,t,a)}else if(O&&!t.parentURL?.includes("/node_modules/")){const r=O(e);for(const n of r)try{return await F(P.pathToFileURL(n).toString(),t,a)}catch{}}if(_.test(t.parentURL)||L){const r=f.resolveTsPath(e);if(r)for(const n of r)try{return await E(a,n,t)}catch(c){const{code:d}=c;if(d!=="ERR_MODULE_NOT_FOUND"&&d!=="ERR_PACKAGE_PATH_NOT_EXPORTED")throw c}}try{const r=await E(a,e,t),n=y(r.url);return i&&!n&&(r.url+=`${r.url.includes("?")?"&":"?"}${w}${i}`),r}catch(r){if(r instanceof Error&&!s){const{code:n}=r;if(n==="ERR_UNSUPPORTED_DIR_IMPORT")try{return await U(e,t,a)}catch(c){if(c.code!=="ERR_PACKAGE_IMPORT_NOT_DEFINED")throw c}if(n==="ERR_MODULE_NOT_FOUND")try{return await v(e,t,a)}catch{}}throw r}};m.isFeatureSupported(m.moduleRegister)&&j.isMainThread&&J.register(),exports.globalPreload=$,exports.initialize=M,exports.load=H,exports.resolve=F;
